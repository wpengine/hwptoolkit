<header class="header">
  <div class="main-header-wrapper">
    <div class="site-title-wrapper">
      <a routerLink="/" class="site-title">
        <h1 *ngIf="siteInfo()?.title && !settingsLoading()">
          {{ siteInfo().title }}
        </h1>
      </a>
    </div>
    <nav class="nav">
      <div *ngIf="navigationLoading()" class="nav-loading">
        <span>Loading navigation...</span>
      </div>

      <!-- Navigation items -->
      <!-- <ul
        *ngIf="!navigationLoading() && menuItems().length > 0;"
        class="nav-menu"
      > -->
        <ng-container *ngFor="let item of menuItems()">
          <ng-container 
            *ngTemplateOutlet="menuItemTemplate; context: { $implicit: item, level: 0 }">
          </ng-container>
        </ng-container>
      <!-- </ul> -->
      
      <!-- Recursive menu item template -->
      <ng-template #menuItemTemplate let-item let-level="level">
        <li
          class="nav-item group relative"
          [class]="'nav-item-level-' + level"
          [class.has-children]="item.children && item.children.length > 0"
        >
          <a
            [href]="item.uri"
            [target]="item.target || '_self'"
            [class]="'nav-link nav-link-level-' + level + ' ' + (item.cssClasses?.join(' ') || '')"
            [class.active]="isActive(item)"
            [title]="item.description || item.title"
            (click)="onMenuItemClick(item); $event.preventDefault()"
          >
            {{ item.label }}
            <!-- Add dropdown indicator for items with children -->
            <span 
              *ngIf="item.children && item.children.length > 0" 
              class="dropdown-indicator"
              [class]="'dropdown-indicator-level-' + level">
              â–¼
            </span>
          </a>

          <!-- Recursive dropdown menu for children -->
          <ul
            *ngIf="item.children && item.children.length > 0"
            class="dropdown-menu"
            [class]="'dropdown-menu-level-' + level"
          >
            <ng-container *ngFor="let child of item.children">
              <ng-container 
                *ngTemplateOutlet="menuItemTemplate; context: { $implicit: child, level: level + 1 }">
              </ng-container>
            </ng-container>
          </ul>
        </li>
      </ng-template>
    </nav>
  </div>
</header>

<div *ngIf="settingsLoading()" class="header-loading">
  <div class="loading-spinner"></div>
  <span>Loading header...</span>
</div>

<div *ngIf="error()" class="header-error">
  <p>{{ error() }}</p>
</div>
