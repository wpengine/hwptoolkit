<div class="container">
  <!-- Loading state -->
  <div *ngIf="loading()" class="text-center py-10">
    <app-loading text="Loading post..."></app-loading>
  </div>

  <!-- Error state -->
  <div *ngIf="error() && !loading()" class="py-10 text-center error-container">
    <h1 class="error-title">Error</h1>
    <p class="error-message">{{ error()?.message || 'Failed to load post' }}</p>
    <div class="error-actions">
      <button (click)="retry()" class="btn btn-primary mr-4">
        Try Again
      </button>
      <a routerLink="/" class="btn btn-secondary">
        Return to Homepage
      </a>
    </div>
  </div>

  <!-- Post content -->
  <article *ngIf="post() && !loading() && !error()" class="post-article">
    <!-- Post header -->
    <header class="post-header">
      <h1 class="post-title">{{ post()!.title }}</h1>
      
      <!-- Post meta info -->
      <div class="post-meta-header">
        <div *ngIf="hasAuthor()" class="author-info">
          <img
            *ngIf="hasAuthorAvatar()"
            [src]="post()!.author!.node.avatar!.url"
            [alt]="post()!.author!.node.name"
            class="author-avatar"
            loading="lazy" />
          <span class="author-name">By {{ post()!.author!.node.name }}</span>
        </div>
        <time class="post-date">{{ formatDate(post()!.date) }}</time>
      </div>
    </header>

    <!-- Featured image -->
    <div *ngIf="hasFeaturedImage()" class="featured-image-container">
      <img
        [src]="post()!.featuredImage!.node.sourceUrl"
        [alt]="post()!.featuredImage!.node.altText || post()!.title"
        class="featured-image"
        loading="lazy" />
    </div>

    <!-- Post content -->
    <div 
      class="post-content prose prose-lg max-w-none"
      [innerHTML]="post()!.content">
    </div>

    <!-- Post meta -->
    <footer class="post-footer">
      <!-- Categories -->
      <div *ngIf="hasCategories()" class="post-categories">
        <span class="meta-label">Categories:</span>
        <div class="categories-list">
          <a
            *ngFor="let category of post()!.categories!.nodes; let i = index"
            [routerLink]="getCategoryLink(category)"
            class="category-link">
            {{ category.name }}{{ !isLastItem(i, post()!.categories!.nodes) ? ',' : '' }}
          </a>
        </div>
      </div>

      <!-- Tags -->
      <div *ngIf="hasTags()" class="post-tags">
        <h3 class="meta-label">Tags:</h3>
        <div class="tags-list">
          <a
            *ngFor="let tag of post()!.tags!.nodes; let i = index"
            [routerLink]="getTagLink(tag)"
            class="tag-link">
            {{ tag.name }}{{ !isLastItem(i, post()!.tags!.nodes) ? ',' : '' }}
          </a>
        </div>
      </div>

      <!-- Comment count -->
      <div *ngIf="post()!.commentCount > 0" class="comment-count">
        <span class="meta-label">Comments:</span>
        <span>{{ post()!.commentCount }}</span>
      </div>
    </footer>

    <!-- Comments section -->
    <div *ngIf="postId()" class="comments-section">
      <app-comments [postId]="postId()!"></app-comments>
    </div>
  </article>

  <!-- Not found fallback -->
  <div *ngIf="!post() && !loading() && !error()">
    <app-not-found></app-not-found>
  </div>
</div>